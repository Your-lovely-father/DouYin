(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-1ffdda46"],{"2d3b":function(t,e,s){"use strict";s.r(e);var i=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"searchWrap"},[s("div",{staticClass:"topBar"},[s("span",{staticClass:"iconfont icon-left",on:{click:function(e){t.$router.push("/home")}}}),s("search-bar",{ref:"searchBar",staticClass:"searchBar",attrs:{placeholder:t.placeholder},on:{query:t.query}})],1),s("div",{staticClass:"tab"},[s("router-link",{staticClass:"tab-item",attrs:{tag:"div",to:"/search/video"}},[s("span",{staticClass:"tab-link"},[t._v("视频")])]),s("router-link",{staticClass:"tab-item",attrs:{tag:"div",to:"/search/user"}},[s("span",{staticClass:"tab-link"},[t._v("用户")])])],1),s("router-view",{attrs:{searches:t.searches},on:{select:t.selectItem,chooseVideo:t.chooseVideo,scrollToEnd:t.scrollToEnd}}),s("transition",{attrs:{name:"left"}},[s("play-list",{directives:[{name:"show",rawName:"v-show",value:t.showPlayList,expression:"showPlayList"}],ref:"playList",staticClass:"play-list",on:{close:function(e){t.showPlayList=!1}}})],1)],1)},o=[],a=(s("7f7f"),s("be94")),n=s("8431"),c=s("db6f"),r=s("2f62"),h=21,l={data:function(){return{querykey:"",searches:[],page:0,isEnd:!1,showPlayList:!1}},watch:{$route:function(t){this.$refs.searchBar.clear(),this.querykey="",this.page=1,this.isEnd=!1,this.searches=[],this.showPlayList=!1}},computed:Object(a["a"])({placeholder:function(){var t=this.$route.name;return"search/user"===t?"输入关键字进行搜索（昵称、id）":"search/video"===t?"输入关键字进行搜索（视频描述）":void 0}},Object(r["c"])(["loginInfo"])),methods:Object(a["a"])({scrollToEnd:function(){if(!this.isEnd){var t=this.$route.name;"search/user"===t?(this.page++,this.fetchSearchUserList()):"search/video"===t&&(this.page++,this.fetchSearchVideoList())}},query:function(t){if(this.querykey=t,t){var e=this.$route.name;this.page=1,this.isEnd=!1,this.searches=[],"search/user"===e?this.fetchSearchUserList():"search/video"===e&&this.fetchSearchVideoList()}},fetchSearchUserList:function(){var t=this;this.isEnd||this.$axios.post("/api/user/".concat(this.loginInfo.userId,"/searchUser/").concat(this.page),{key:this.querykey}).then(function(e){e.data.data.length<h&&(t.isEnd=!0),t.searches=t.searches.concat(e.data.data)})},fetchSearchVideoList:function(){var t=this;this.isEnd||this.$axios.post("/api/user/".concat(this.loginInfo.userId,"/searchVideo/").concat(this.page),{key:this.querykey}).then(function(e){e.data.data.length<h&&(t.isEnd=!0),t.searches=t.searches.concat(e.data.data)})},selectItem:function(t){this.$router.push("/profile/".concat(t.userId))},chooseVideo:function(t){this.showPlayList=!0,this.SET_PLAYLIST(this.searches),this.$refs.playList.scrollToIndex(t)}},Object(r["d"])(["SET_PLAYLIST"])),components:{SearchBar:c["a"],PlayList:n["a"]}},d=l,u=(s("e2c4"),s("2877")),m=Object(u["a"])(d,i,o,!1,null,"e7b45be2",null);m.options.__file="Search.vue";e["default"]=m.exports},3038:function(t,e,s){"use strict";var i=s("3f67"),o=s.n(i);o.a},"3f67":function(t,e,s){},"7eb9":function(t,e,s){},8431:function(t,e,s){"use strict";var i=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{on:{"!click":function(e){t.closeCommentList(e)}}},[s("div",{staticClass:"back iconfont icon-left",on:{click:t.close}}),s("scroll",{ref:"scroll",staticClass:"wrap",style:t.VideoItemHeightStyle,attrs:{probeType:3,data:t.playList,scrollEnd:!0,momentum:!1},on:{scrollEnd:t.scrollEnd}},[s("div",t._l(t.playList,function(e,i){return s("my-video",{key:i,ref:"videos",refInFor:!0,attrs:{VideoItem:e},on:{playVideo:t.playHandler,showCommentList:t.fetchCommentsAndShowList}})}))]),s("transition",{attrs:{name:"up"}},[t.showCommentList?s("comment-list",{attrs:{commentList:t.commentList,commentNum:t.commentNum,currentCommentVideoId:t.currentCommentVideoId},on:{close:t.closeCommentList,scrollToEnd:t.fetchCommentsAndShowList}}):t._e()],1)],1)},o=[],a=(s("6762"),s("2fdb"),s("ac6a"),s("be94")),n=(s("cadf"),s("551c"),s("097d"),s("e9fc")),c=s("656e"),r=s("2ce0"),h=s("8b55"),l=s("2f62"),d={data:function(){return{currentY:0,showCommentList:!1,commentNum:0,commentList:[],page:0,currentCommentVideoId:"",isEnd:!1}},methods:Object(a["a"])({playHandler:function(t){var e=t.target;e.paused?(this.$refs.videos.forEach(function(t){t.$refs.video.pause()}),e.play()):e.pause()},scrollEnd:function(t){var e=this.clientHeight;Math.abs(t.y)<this.currentY-e/2&&(this.currentY-=e,this.$refs.scroll.scrollTo(0,-this.currentY)),Math.abs(t.y)<this.currentY+e/2?this.$refs.scroll.scrollTo(0,-this.currentY):(this.currentY+=e,this.$refs.scroll.scrollTo(0,-this.currentY))},fetchCommentsAndShowList:function(t,e){var s=this;if(this.currentCommentVideoId!==t)this.isEnd=!1,this.page=1,this.currentCommentVideoId=t,this.commentNum=e,this.$axios.get("/api/video/".concat(t,"/getVideoComment/page/").concat(this.page)).then(function(t){t.data.data.length<20&&(s.isEnd=!0),s.commentList=Object(h["b"])(t.data.data),s.showCommentList=!0});else{if(this.page++,this.isEnd)return;this.$axios.get("/api/video/".concat(t,"/getVideoComment/page/").concat(this.page)).then(function(t){t.data.data.length<20&&(s.isEnd=!0),s.commentList=Object(h["b"])(s.commentList.concat(t.data.data)),s.showCommentList=!0})}},scrollToIndex:function(t){this.currentY=t*this.clientHeight,this.$refs.scroll.scrollTo(0,-this.currentY)},close:function(){this.$emit("close")},closeCommentList:function(t){this.showCommentList&&("VIDEO"===t.target.nodeName||t.target.className.includes("icon-close"))&&(this.currentCommentVideoId="",t.stopPropagation(),this.showCommentList=!1)}},Object(l["b"])(["getPopularVideo"])),computed:Object(a["a"])({clientHeight:function(){return document.body.clientHeight},VideoItemHeightStyle:function(){var t=document.body.clientWidth,e=document.body.clientHeight;return{height:e+"px",width:t+"px"}}},Object(l["c"])(["playList"])),components:{MyVideo:c["a"],Scroll:n["a"],CommentList:r["a"]}},u=d,m=(s("3038"),s("2877")),f=Object(m["a"])(u,i,o,!1,null,"cbf47aca",null);f.options.__file="PlayList.vue";e["a"]=f.exports},e2c4:function(t,e,s){"use strict";var i=s("7eb9"),o=s.n(i);o.a}}]);