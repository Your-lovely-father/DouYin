(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-a889b080"],{"52f7":function(t,e,r){},"89d4":function(t,e,r){"use strict";var n=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"myList"},[r("div",{staticClass:"topBar"},[r("span",{staticClass:"backbtn iconfont icon-left",on:{click:t.GoBack}}),r("p",{staticClass:"title"},[t._v(t._s(t.Title))])]),r("scroll",{staticClass:"scroll-wrap",class:{"scroll-wrap-bottom":t.needBottomMargin},attrs:{pullup:!0},on:{scrollToEnd:t.scrollToEnd}},[r("ul",[t._t("default")],2)])],1)},a=[],i=r("e9fc"),s={props:{Title:{type:String,default:""},needBottomMargin:{type:Boolean,default:!1}},methods:{GoBack:function(){this.$router.back()},scrollToEnd:function(){this.$emit("scrollToEnd")}},components:{Scroll:i["a"]}},o=s,c=(r("cfc8"),r("2877")),u=Object(c["a"])(o,n,a,!1,null,"1aedd296",null);u.options.__file="myList.vue";e["a"]=u.exports},a4cf:function(t,e,r){"use strict";r.r(e);var n=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",[r("my-list",{ref:"scroll",attrs:{Title:t.$route.query.userNickname,needBottomMargin:!0}},t._l(t.chatList,function(e){return r("div",{key:e.id,staticClass:"chat-item"},["time"!==e.type&&e.content.isMe?r("div",{staticClass:"right"},[r("div",{staticClass:"content"},[t._v("\n            "+t._s(e.content.content)+"\n          ")]),r("img",{staticClass:"avatar",attrs:{src:""+t.baseURL+t.loginInfo.userAvatar,alt:"",width:"40",height:"40"}})]):"time"===e.type||e.isMe?r("span",{staticClass:"time"},[t._v(t._s(e.content))]):r("div",{staticClass:"left"},[r("img",{staticClass:"avatar",attrs:{src:""+t.baseURL+t.$route.query.userAvatar,alt:"",width:"40",height:"40"}}),r("div",{staticClass:"content"},[t._v("\n            "+t._s(e.content.content)+"\n          ")])])])})),r("div",{staticClass:"input-bar"},[r("input",{directives:[{name:"model",rawName:"v-model",value:t.privateLetterContent,expression:"privateLetterContent"}],staticClass:"input",attrs:{placeholder:"  发送消息...",type:"text"},domProps:{value:t.privateLetterContent},on:{keyup:function(e){return"button"in e||!t._k(e.keyCode,"enter",13,e.key,"Enter")?t.sendPrivateLetter(e):null},blur:t.inputBlur,input:function(e){e.target.composing||(t.privateLetterContent=e.target.value)}}}),r("span",{staticClass:"iconfont icon-at"}),r("span",{staticClass:"iconfont icon-check",on:{click:t.sendPrivateLetter}})])],1)},a=[];function i(t){if(Array.isArray(t))return t}function s(t,e){var r=[],n=!0,a=!1,i=void 0;try{for(var s,o=t[Symbol.iterator]();!(n=(s=o.next()).done);n=!0)if(r.push(s.value),e&&r.length===e)break}catch(c){a=!0,i=c}finally{try{n||null==o["return"]||o["return"]()}finally{if(a)throw i}}return r}function o(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function c(t,e){return i(t)||s(t,e)||o()}r("ac4d"),r("8a81"),r("96cf");var u=r("1da1"),d=(r("ac6a"),r("be94")),l=(r("cadf"),r("551c"),r("097d"),r("89d4")),f=r("41ea"),v=r("8b55"),p=r("2f62"),h={activated:function(){var t=this,e=this.loginInfo.userId,r=this.$route.params.id;this.resetAndGetUnread(r),this.getPrivateLetter(e,r),this.readPrivateLetter(e,r),this.sockets.subscribe("receivePrivateLetter",function(e){e.fromId!==t.loginInfo.userId&&(t.addMessageLocal({type:"privateLetter",content:{id:e.fromId,isMe:e.fromId===t.loginInfo.userId,content:e.content,time:e.createdAt}}),t.$store.commit("UPDATE_PRIVATELETTER",{fromId:e.fromId,toId:e.toId,content:e.content,createdAt:e.createdAt,userAvatar:e.userAvatar,userNickname:e.userNickname,type:"privateLetter",isEnterChat:t.$route.params.id===e.fromId}),t.scrollToBottom())})},updated:function(){this.scrollToBottom()},data:function(){return{unread:0,chatList:[],privateLetterContent:"",baseURL:f["a"]}},computed:Object(d["a"])({},Object(p["c"])(["loginInfo","allPrivateLetter"])),watch:{allMessage:function(){this.getUnread()}},methods:{inputBlur:function(){window.scroll(0,0)},scrollToBottom:function(){var t=this;setTimeout(function(){var e=t.$refs.scroll.$children[0];e.scrollTo(0,e.scroll.maxScrollY)},30)},resetAndGetUnread:function(t){this.chatList=[],this.$store.commit("UPDATE_UNREAD_PRIVATELETTER",{fromId:t}),this.getUnread()},getUnread:function(){var t=0;this.allPrivateLetter.forEach(function(e){t+=e.unread}),this.unread=t},getPrivateLetter:function(){var t=Object(u["a"])(regeneratorRuntime.mark(function t(e,r){var n,a,i,s,o,u,d,l,f,v,p;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.$axios.get("/api/user/".concat(e,"/getPrivateLetter/").concat(r));case 2:if(n=t.sent,a=n.data.data,0!==a.length){t.next=6;break}return t.abrupt("return");case 6:for(this.isAddTimeMessage(0,a[0].createdAt),i=!0,s=!1,o=void 0,t.prev=10,u=a.entries()[Symbol.iterator]();!(i=(d=u.next()).done);i=!0)l=c(d.value,2),f=l[0],v=l[1],f>0&&this.isAddTimeMessage(1,v.createdAt,a[f-1].createdAt),p={type:"privateLetter",content:{id:v.fromId,isMe:v.fromId===this.loginInfo.userId,content:v.privateLetterContent,time:v.createdAt}},this.chatList.push(p);t.next=18;break;case 14:t.prev=14,t.t0=t["catch"](10),s=!0,o=t.t0;case 18:t.prev=18,t.prev=19,i||null==u.return||u.return();case 21:if(t.prev=21,!s){t.next=24;break}throw o;case 24:return t.finish(21);case 25:return t.finish(18);case 26:case"end":return t.stop()}},t,this,[[10,14,18,26],[19,,21,25]])}));return function(e,r){return t.apply(this,arguments)}}(),readPrivateLetter:function(){var t=Object(u["a"])(regeneratorRuntime.mark(function t(e,r){var n;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.$axios.get("/api/user/".concat(e,"/readPrivateLetter/").concat(r));case 2:n=t.sent,n.data.code;case 4:case"end":return t.stop()}},t,this)}));return function(e,r){return t.apply(this,arguments)}}(),addMessageLocal:function(t){var e=this.chatList;if(0===e.length)this.isAddTimeMessage(0,t.content.time);else{var r=e[e.length-1],n=r.content.time;this.isAddTimeMessage(1,t.content.time,n)}this.chatList.push(t)},isAddTimeMessage:function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";if(t){var n=18e5;e-r>n&&this.chatList.push({type:"time",content:Object(v["e"])(e)})}else this.chatList.push({type:"time",content:Object(v["e"])(e)})},sendPrivateLetter:function(){var t=this,e=this.privateLetterContent.trim();if(e){var r={content:e,fromUserId:this.loginInfo.userId,toUserId:this.$route.params.id};this.$axios.post("/api/user/".concat(r.fromUserId,"/privateLetter/").concat(r.toUserId),r).then(function(e){var r=e.data.data;t.$socket.emit("sendPrivateLetter",{fromId:t.loginInfo.userId,toId:r.toId,content:r.privateLetterContent,createdAt:r.createdAt,userAvatar:t.loginInfo.userAvatar,userNickname:t.loginInfo.userNickname}),t.addMessageLocal({type:"privateLetter",content:{id:r.fromId,isMe:r.fromId===t.loginInfo.userId,content:r.privateLetterContent,time:r.createdAt}}),t.$store.commit("UPDATE_PRIVATELETTER",{fromId:r.toId,content:r.privateLetterContent,createdAt:r.createdAt,userAvatar:t.$route.query.userAvatar,userNickname:t.$route.query.userNickname,type:"privateLetter",isEnterChat:!0}),t.scrollToBottom()}),this.privateLetterContent=""}}},beforeRouteLeave:function(t,e,r){this.sockets.unsubscribe("receivePrivateLetter"),r()},components:{MyList:l["a"]}},m=h,L=(r("bd5a"),r("2877")),g=Object(L["a"])(m,n,a,!1,null,"6b7045a6",null);g.options.__file="ChatWith.vue";e["default"]=g.exports},bd5a:function(t,e,r){"use strict";var n=r("52f7"),a=r.n(n);a.a},cfc8:function(t,e,r){"use strict";var n=r("df3c"),a=r.n(n);a.a},df3c:function(t,e,r){}}]);